{% extends "delphi/base.html" %}
{% block content %}
<h2>{{ round }}</h2>

{% if submitted %}
  <div style="padding:10px; border:1px solid #ccc; background:#f7f7f7; margin:10px 0;">
    <strong>Submitted.</strong> Your responses for this round are locked.
    <div style="font-size: 0.9em; color:#555;">Submitted at: {{ submitted.submitted_at }}</div>
  </div>
{% else %}
  <div style="padding:10px; border:1px solid #e0e0e0; background:#fafafa; margin:10px 0;">
    Answered: <strong>{{ answered }}/{{ total }}</strong>.
    When youâ€™re ready, click <strong>Submit Round</strong> to lock your answers.
  </div>
{% endif %}

<ul>
  {% for row in rows %}
    {% with ri=row.ri resp=row.response %}
      <li style="margin: 8px 0;">
        <div><strong>Item {{ forloop.counter }}:</strong> {{ ri.item.prompt }}</div>

        {% if resp %}
          <div><em>Your response:</em> {{ resp.value }}</div>
          <div>
            <a href="{% url 'item_detail' ri.id %}">
              {% if submitted %}View{% else %}Edit{% endif %}
            </a>
          </div>
        {% else %}
          <div><em>No response yet.</em></div>
          <div><a href="{% url 'item_detail' ri.id %}">Answer</a></div>
        {% endif %}
      </li>
    {% endwith %}
  {% empty %}
    <li>No items assigned to this round yet.</li>
  {% endfor %}
</ul>

{% if not submitted %}
  <hr>
  <form method="post" action="{% url 'submit_round' round.id %}">
    {% csrf_token %}
    <button type="submit" {% if not can_submit %}disabled{% endif %}>
      Submit Round
    </button>
    {% if not can_submit %}
      <div style="font-size:0.9em; color:#777; margin-top:6px;">
        You must answer all items ({{ answered }}/{{ total }}) before submitting.
      </div>
    {% endif %}
  </form>
{% endif %}
{% endblock %}
