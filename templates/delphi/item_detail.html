{% extends "delphi/base.html" %}
{% block content %}
<h2>Item (Round {{ round_item.round.number }})</h2>
<p>{{ round_item.item.prompt }}</p>

{% if locked %}
  <div style="padding:10px; border:1px solid #ccc; background:#f7f7f7; margin:10px 0;">
    <strong>Submitted.</strong> This round is locked; you can view but not edit.
  </div>
{% endif %}

{% if response %}
  <p><strong>Your response:</strong> {{ response.value }}</p>
{% endif %}

{% if not locked %}
  <form method="post">
    {% csrf_token %}
    {% if round_item.item.item_type == 'likert5' %}
      <label>Choose 1-5:</label>
      <select name="value" required>
        <option value="">--</option>
        {% for i in "12345" %}
          <option value="{{ i }}" {% if response and response.value == i %}selected{% endif %}>{{ i }}</option>
        {% endfor %}
      </select>
    {% elif round_item.item.item_type == 'yesno' %}
      <label>Yes/No:</label>
      <select name="value" required>
        <option value="">--</option>
        <option value="yes" {% if response and response.value == "yes" %}selected{% endif %}>Yes</option>
        <option value="no" {% if response and response.value == "no" %}selected{% endif %}>No</option>
      </select>
    {% else %}
      <label>Your answer:</label>
      <textarea name="value" rows="4" cols="60" required>{% if response %}{{ response.value }}{% endif %}</textarea>
    {% endif %}
    <button type="submit">Save response</button>
  </form>
{% endif %}

{% if feedback_allowed and aggregate and round_item.item.item_type == 'likert5' %}
  <hr>
  <h3>Group feedback (mean)</h3>
  <p>{{ aggregate.mean|floatformat:2 }}</p>
{% endif %}

<p><a href="{% url 'round_overview' round_item.round.id %}">Back to Round</a></p>
{% endblock %}
